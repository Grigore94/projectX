<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Favorite farms</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

</head>
<style>
  * {
    box-sizing: border-box
  }

  body {
    background-color: rgb(230, 230, 230);
  }

  .flex-container {
    margin-top: 15px;
    width: auto;
    height: 750px;
    flex-direction: row;
    display: inline-table;
    flex-wrap: wrap;
    background-color: rgb(228, 220, 213);
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.6), 0 6px 20px 0 rgba(0, 0, 0, 0.29);
  }

  .place-list {
    margin-top: 5px;
    width: auto;
    height: 280px;
    flex-direction: column;
    display: inline-table;
    flex-wrap: wrap;
    background-color: rgb(228, 220, 213);
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.6), 0 6px 20px 0 rgba(0, 0, 0, 0.29);
  }


  .container>h1 {
    text-align: center;
    font-family: Georgia, 'Times New Roman', Times, serif
  }

  /* navbar css */
  .nav a {
    margin-right: 0;
    float: right;
    color: #F2F2F2;
    padding: 14px 16px 14px;
    text-decoration: none;
    font-size: 19px;
  }

  .nav {
    background-color: #333;
    overflow: hidden;
    margin-bottom: 10px;


  }

  .topnav a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav>h3 {
    width: 75%;
    color: blanchedalmond;
    font-family: Georgia, 'Times New Roman', Times, serif;
    text-align: center;
  }

  .topnav a:hover {
    background-color: #ddd;
    color: black;
  }

  .farm-input {
    width: 450px;
    border: 1px solid black;
  }

  .farm-form {
    text-align: center;
    justify-content: center;
  }

  /*footer */
  .footer {
    clear: both;
    color: rgb(73, 69, 69);
    text-align: center;
    flex-shrink: 0;
    margin-bottom: -50px;
  }

  .fa {
    padding: 10px;
    font-size: 30px;
    width: 40px;
    text-align: center;
    text-decoration: none;
    border-radius: 50%;
  }

  /* Add a hover effect if you want */
  .fa:hover {
    opacity: 0.3;
  }

  .fa-facebook-square {
    font-size: 24px;
    background: #3B5998;
    color: white;
  }

  .fa-twitter-square {
    font-size: 24px;
    background: #55ACEE;
    color: white;
  }

  .fa-linkedin-square {
    font-size: 24px;
    background: #007bb5;
    color: white;
  }
</style>
<nav class="nav">
  <h3>Welcome to Favorite Farms</h3>
    <!-- Collapse button -->
    <button class="navbar-toggler toggler-example" type="button" data-toggle="collapse" data-target="#navbarSupportedContent1"
    aria-controls="navbarSupportedContent1" aria-expanded="false" aria-label="Toggle navigation"><span class="dark-blue-text"><i
        class="fas fa-bars fa-1x"></i></span></button>

  <!-- Collapsible content -->
  <div class="collapse navbar-collapse" id="navbarSupportedContent1">

    <!-- Links -->
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Shop-Now</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Contact</a>
      </li>
    </ul>
    <!-- Links -->

  </div>
  <!-- Collapsible content -->
  <a href="contact.html">Contact</a>
  <a href="shop-now.html">Shop-Now</a>
  <a class="active" href="index.html">Home</a>
</nav>
</div>

<body>
  <div class="container">
    <h1>Market Search</h1>

    <!-- This form will be where users input data about the farms -->
    <form id="farm-form" class="farm-form">
      <label for="farm-input">Search for a market near you</label>
      <input type="text" id="farm-input" class="farm-input"><br>

      <!-- This button will trigger our AJAX call -->
      <input id="find-farm" class="find-farmBtn" type="submit" value="Farm Search">
    </form>

    <!-- We'll be dumping our JSON contents in here -->
    <div id="find-view" class="place-list"></div>
    <div id="farm-view" class="flex-container"></div>

    <!--Scripts starrts from here-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

      $(document).ready(function () {
        getLocation()
        var x = 0;
        var y = 0;
        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
          } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
          }
        }
        function showPosition(position) {

          x = position.coords.latitude
          y = position.coords.longitude
        }
        var array = [];
        $("#find-farm").on("click", function (event) {
          event.preventDefault();
          console.log(x)
          console.log(y)

          var query = "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/locSearch?lat=" + x + "&lng=" + y
          $.ajax({
            url: query,
            method: "GET"
          }).then(function (response) {
            var head = $("<h1> Places near You </h1><hr>")
            for (var i = 0; i < 10; i++) {
              console.log(response.results[i])
              var list = $("<li id=" + response.results[i].id + " >" + JSON.stringify(response.results[i].marketname) + "</li>")
              array.push(response.results[i].id);
              $("#find-view").append(list);

              query = "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/mktDetail?id=" + response.results[i].id
              $.ajax({
                url: query,
                method: "GET"
              }).then(function (response) {

                var deats = response.marketdetails;
                console.log(deats);
                var pah = $("<p> " + JSON.stringify(response.marketdetails) + "</p><hr>")
                $("#farm-view").append(pah);
              });
            }
            $("#farm-view").prepend(head);
          })
        });
      })


    </script>


  </div>
</body>
<hr>
<footer class="footer">
  <p>&copy; 2020 <p>
      <a href="#" class="fa fa-facebook-square"></a>
      <a href="#" class="fa fa-twitter-square"></a>
      <a href="#" class="fa fa-linkedin-square"></a>
</footer>

</html>